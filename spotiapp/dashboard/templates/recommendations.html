{% extends 'base.html' %}

{% block title %}Recommendations{% endblock %}

{% block content %}
<h1>Recommendations</h1>

<div class="recommendations-container">
    <form method="POST" action="{% url 'create_playlist' %}">
        {% csrf_token %}
        
        <div class="recommendations-list">
            {% if recommendations %}
                <div class="tracks-list">
                    {% for track in recommendations %}
                        <div class="track" data-track-id="{{ track.id }}">
                            {% if track.album.images %}
                                <img src="{{ track.album.images.0.url }}" alt="{{ track.name }}" class="album-cover">
                            {% else %}
                                <img src="https://via.placeholder.com/100" alt="No image available" class="album-cover">
                            {% endif %}
                            
                            <div class="track-info">
                                <h2>{{ track.name }}</h2>
                                <p><strong>Artist:</strong> {{ track.artists.0.name }}</p>
                                <p><strong>Album:</strong> {{ track.album.name }}</p>
                                
                                {% if track.preview_url %}
                                    <audio controls>
                                        <source src="{{ track.preview_url }}" type="audio/mpeg">
                                        Your browser does not support the audio element.
                                    </audio>
                                {% else %}
                                    <p>No preview available</p>
                                {% endif %}
                            </div>
                            
                            <!-- Add checkbox to select tracks -->
                            <input type="checkbox" name="selected_tracks" value="{{ track.id }}" class="track-checkbox">
                        </div>
                    {% endfor %}
                </div>
                
                <!-- More Recommendations button -->
                {% if next_page %}
                    <button type="button" id="more-recommendations-btn" data-next-page="{{ next_page }}">More Recommendations</button>
                {% endif %}
            {% elif error %}
                <p>{{ error }}</p>
            {% else %}
                <p>No recommendations available at the moment.</p>
            {% endif %}
        </div>
        
        <!-- Button to create a playlist -->
        <button type="submit" id="create-playlist-btn" disabled>Turn into Playlist</button>
    </form>
</div>

<script>
    const checkboxes = document.querySelectorAll('.track-checkbox');
    const createPlaylistBtn = document.getElementById('create-playlist-btn');
    
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const checkedBoxes = document.querySelectorAll('.track-checkbox:checked');
            createPlaylistBtn.disabled = checkedBoxes.length === 0;
            
            // Highlight selected tracks
            checkboxes.forEach(cb => {
                const trackDiv = cb.closest('.track');
                if (cb.checked) {
                    trackDiv.classList.add('selected');
                } else {
                    trackDiv.classList.remove('selected');
                }
            });
        });
    });

    // Handle More Recommendations button click
    document.getElementById('more-recommendations-btn')?.addEventListener('click', function() {
        const nextPage = this.getAttribute('data-next-page');
        if (nextPage) {
            window.location.href = `?page=${nextPage}`;  // Adjust based on your URL structure
        }
    });
</script>

{% endblock %}
